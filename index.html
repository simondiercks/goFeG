<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>goFeG</title>
  <script type='text/javascript' src='http://code.jquery.com/jquery-2.0.0.js'></script>
  <script type="text/javascript" src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.js"></script>
  <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.css">
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&language=de"></script>
  <script type='text/javascript' src="js/gmap3.js"></script>
  <style type='text/css'>
    #map{
        height: 350px;
        width: 100%;
    }
  </style>
  

<script type='text/javascript'>
    
function jsoncallback( data ) {
    if (data.success) {
        fegmarker = {"values":[]};
	$("#liste > li").remove();
        $('#map').gmap3({
            clear: {
              name:["marker"]
            }
        });
	$('#map').gmap3({
	  getgeoloc:{
		callback : function(latLng){
		  if (latLng){
                        mylat = latLng.lat();
                        mylng = latLng.lng();
			$(this).gmap3({
			  marker:{ 
				latLng:latLng
			  }
			});
		  }
		}
	  }
	});
        $.each( data.data, function( key, value ) {
            $('#liste').append($('<li/>').append($('<a/>', {    
                'href': "geo:0,0?q="+value.data+"&z=18",
                'data-transition': 'slide',
                'text': "FeG "+value.data+" ("+Math.round(value.distance)+" km)"
            })));
            $('#liste').listview('refresh');
            value.options = {icon: "img/logo_googlemaps.png"};
           fegmarker.values.push(value);
        });
	$('#map').show().gmap3({
                marker:fegmarker,
		autofit:{}
	}).css('border', '1px solid #000000');
    } else {
        alert('Keine Gemeinden gefunden. Bitte erweitere den Umkreis.');
    } 
    $.mobile.loading('hide');
}

mylat = 0.00;
mylng = 0.00;
function goFeG() {
	$.mobile.loading('show');
	$('#map').gmap3({
	  getgeoloc:{
		callback : function(latLng){
		  if (latLng){
                        mylat = latLng.lat();
                        mylng = latLng.lng();
			$(this).gmap3({
			  marker:{ 
				latLng:latLng
			  }
			});
		  }
		}
	  }
	});
        $.getJSON("http://z.sese.de/gofeg/go.php?jsoncallback=?&lat="+latLng.lat()+"&lng="+latLng.lng()+"&dist="+$('#dist').val());
}
        
$(window).load(function(){
	goFeG();
}); 

/**
function showDir() {
	$("#map").gmap3({ 
	  getroute:{
		options:{
			origin:"jülich",
			destination:"hamburg",
			travelMode: google.maps.DirectionsTravelMode.DRIVING
		},
		callback: function(results){
		  if (!results) return;
		  $(this).gmap3({
			map:{
			  options:{
				zoom: 13,  
				center: [-33.879, 151.235]
			  }
			},
			directionsrenderer:{
			  options:{
				directions:results
			  } 
			}
		  });
		}
	  }
	});
}
*/
</script>


</head>
<body>
        <div data-role="page">
            <div data-role="header">
                <h1>goFeG</h1>
            </div>
            <div data-role="content">
                <form>
                   <label for="slider-0">Maximale Entfernung (km):</label>
                   <input type="range" name="slider" id="dist" value="50" min="0" max="200"  />
                </form>
                <p>FeGn in Deiner Nähe:</p>
                <ul id="liste" data-role="listview" data-inset="true" data-filter="true">
                </ul>
                <a href="#" id="go" onclick="goFeG();" data-role="button">Zeige die Karte meiner Umgebung</a>
            </div>
            <div id="map">
            </div>
        </div>
  
</body>


</html>

