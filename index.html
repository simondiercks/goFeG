<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>goFeG</title>
  <script type='text/javascript' src='http://code.jquery.com/jquery-2.0.0.js'></script>
  <script type="text/javascript" src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.js"></script>
  <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.css">
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&language=de"></script>
  <script type='text/javascript' src="js/gmap3.js"></script>
  <style type='text/css'>
    #map{
 height: 350px;
 width: 100%;
}
  </style>
  

<script type='text/javascript'>
    
function jsoncallback( data ) {
    if (data.success) {
        fegmarker = {"values":[]};
		$("#liste > li").remove();
        $.each( data.data, function( key, value ) {
			$('#liste').append($('<li/>', {   
				
			}).append($('<a/>', {    
				'href': '#',
				'data-transition': 'slide',
				'text': "FeG "+value.data+" ("+Math.round(value.distance)+" km)"
			})));

			$('#liste').listview('refresh');
			value.options = {icon: "img/logo_googlemaps.png"};
            fegmarker.values.push(value);
        });
        console.dir(fegmarker);
	$('#map').show().gmap3({
                options:{
                   zoom:4,
                   navigationControl: true,
                   scrollwheel: true,
                   streetViewControl: true
                },		
                marker:fegmarker,
		autofit:{},
                /**
		getgeoloc:{
			callback : function(latLng){
			  if (latLng){
				$(this).gmap3({
				  marker:{ 
					latLng:latLng
				  },
				  map:{
					options:{
					  zoom: 5
					}
				  }
				});
			  }
			}
		},
		getdistance:{
			options:{ 
			  origins:["Marseille"], 
			  destinations:["Paris"],
			  travelMode: google.maps.TravelMode.DRIVING
			},
			callback: function(results, status){
			  var html = "";
			  if (results){
				for (var i = 0; i < results.rows.length; i++){
				  var elements = results.rows[i].elements;
				  for(var j=0; j<elements.length; j++){
					switch(elements[j].status){
					  case "OK":
						html += elements[j].distance.text + " (" + elements[j].duration.text + ")<br />";
						break;
					  case "NOT_FOUND":
						html += "The origin and/or destination of this pairing could not be geocoded<br />";
						break;
					  case "ZERO_RESULTS":
						html += "No route could be found between the origin and destination.<br />";
						break;
					}
				  }
				} 
			  } else {
				html = "error";
			  }
			  $("#test").html( html );
			}
		}
                */
		
	}).css('border', '1px solid #000000');
    } else {
        alert('Keine Gemeinden gefunden. Bitte erweitere den Umkreis.');
    } 
	$.mobile.loading('hide');
}

function goFeG() {
	$.mobile.loading('show');
	$('#map').gmap3({
	  getgeoloc:{
		callback : function(latLng){
		  if (latLng){
			$(this).gmap3({
			  marker:{ 
				latLng:latLng
			  }
			});
			$.getJSON("http://z.sese.de/gofeg/go.php?jsoncallback=?&lat="+latLng.lat()+"&lng="+latLng.lng()+"&dist="+$('#dist').val());
		  }
		}
	  }
	});
}
        
$(window).load(function(){
	goFeG();
}); 

/**
function showDir() {
	$("#map").gmap3({ 
	  getroute:{
		options:{
			origin:"jülich",
			destination:"hamburg",
			travelMode: google.maps.DirectionsTravelMode.DRIVING
		},
		callback: function(results){
		  if (!results) return;
		  $(this).gmap3({
			map:{
			  options:{
				zoom: 13,  
				center: [-33.879, 151.235]
			  }
			},
			directionsrenderer:{
			  options:{
				directions:results
			  } 
			}
		  });
		}
	  }
	});
}
*/

$("test").gmap3({
  getdistance:{
    options:{ 
      origins:["Marseille"], 
      destinations:["Paris"],
      travelMode: google.maps.TravelMode.DRIVING
    },
    callback: function(results, status){
      var html = "";
      if (results){
        for (var i = 0; i < results.rows.length; i++){
          var elements = results.rows[i].elements;
          for(var j=0; j<elements.length; j++){
            switch(elements[j].status){
              case "OK":
                html += elements[j].distance.text;
                break;
              case "NOT_FOUND":
                html += "The origin and/or destination of this pairing could not be geocoded<br />";
                break;
              case "ZERO_RESULTS":
                html += "No route could be found between the origin and destination.<br />";
                break;
            }
          }
        } 
      } else {
        html = "error";
      }
      $("#test").html( html );
    }
  }
});
</script>


</head>
<body>
      <body>
        <div data-role="page">
            <div data-role="header">
                <h1>goFeG</h1>
            </div>
            <!-- /header -->
            <div data-role="content">
                <form>
                   <label for="slider-0">Maximale Entfernung (km):</label>
                   <input type="range" name="slider" id="dist" value="50" min="0" max="200"  />
                </form>
                <p>FeGn in Deiner Nähe:</p>
                <ul id="liste" data-role="listview" data-inset="true" data-filter="true">
                </ul>
                <a href="#" id="go" onclick="goFeG();" data-role="button">Zeige die Karte meiner Umgebung</a>
            </div>
            <div id="map">
            </div>
            <!-- /content -->
        </div>
        <!-- /page -->
    </body>
  
</body>


</html>

